<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>QR JSON Viewer</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 900px;
    margin: 40px auto;
    text-align: center;
  }

  textarea {
    width: 100%;
    height: 220px;
    font-family: Consolas, monospace;
    padding: 10px;
    box-sizing: border-box;
  }

  button {
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }

  #result {
    margin-top: 20px;
  }

  img, svg, canvas {
    max-width: 100%;
  }

  #error {
    color: #b00020;
  }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>

<h2>Renderizador de QR</h2>

<textarea id="jsonInput" placeholder="Cole aqui o JSON..."></textarea>
<br>
<button onclick="renderImage()">Mostrar Imagem</button>

<div id="result"></div>

<script>
function showError(message) {
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = `<p id="error">${message}</p>`;
}

function renderImage() {
  const input = document.getElementById("jsonInput").value;
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  let parsed;
  try {
    parsed = JSON.parse(input);
  } catch {
    showError("JSON inválido.");
    return;
  }

  if (parsed && parsed.format === "svg" && parsed.svg) {
    resultDiv.innerHTML = parsed.svg;
    return;
  }

  if (parsed && parsed.format === "png_data_url" && parsed.dataUrl) {
    const img = document.createElement("img");
    img.src = parsed.dataUrl;
    img.alt = "QR";
    resultDiv.appendChild(img);
    return;
  }

  if (parsed && typeof parsed.qr === "string" && parsed.qr.trim()) {
    if (typeof QRCode === "undefined") {
      showError("Biblioteca de QR não carregada.");
      return;
    }

    const holder = document.createElement("div");
    resultDiv.appendChild(holder);

    new QRCode(holder, {
      text: parsed.qr,
      width: 360,
      height: 360,
      correctLevel: QRCode.CorrectLevel.L
    });
    return;
  }

  showError("Formato não reconhecido. Use {\"qr\":\"...\"}, svg ou png_data_url.");
}
</script>

</body>
</html>
